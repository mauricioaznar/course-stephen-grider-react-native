{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nimport createDataContext from \"./createDataContext\";\nimport trackerApi from \"../api/tracker\";\nimport * as RootNavigation from \"../../RootNavigation.js\";\n\nvar authReducer = function authReducer(state, action) {\n  switch (action.type) {\n    case 'add_error':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: action.payload\n      });\n\n    case 'signin':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: '',\n        token: action.payload\n      });\n\n    case 'clear_error_message':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        errorMessage: ''\n      });\n\n    case 'check_token':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        tokenChecked: true\n      });\n\n    case 'signout':\n      return _objectSpread(_objectSpread({}, state), {}, {\n        token: null,\n        errorMessage: ''\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar clearErrorMessage = function clearErrorMessage(dispatch) {\n  return function () {\n    dispatch({\n      type: 'clear_error_message'\n    });\n  };\n};\n\nvar signin = function signin(dispatch) {\n  return function _callee(_ref) {\n    var email, password, response;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            email = _ref.email, password = _ref.password;\n            _context.prev = 1;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(trackerApi.post('/signin', {\n              email: email,\n              password: password\n            }));\n\n          case 4:\n            response = _context.sent;\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('token', response.data.token));\n\n          case 7:\n            dispatch({\n              type: 'signin',\n              payload: response.data.token\n            });\n            _context.next = 14;\n            break;\n\n          case 10:\n            _context.prev = 10;\n            _context.t0 = _context[\"catch\"](1);\n            console.log(_context.t0);\n            dispatch({\n              type: 'add_error',\n              payload: 'Something went wrong with signin'\n            });\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[1, 10]], Promise);\n  };\n};\n\nvar signup = function signup(dispatch) {\n  return function _callee2(_ref2) {\n    var email, password, response;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            email = _ref2.email, password = _ref2.password;\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(trackerApi.post('/signup', {\n              email: email,\n              password: password\n            }));\n\n          case 4:\n            response = _context2.sent;\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('token', response.data.token));\n\n          case 7:\n            dispatch({\n              type: 'signin',\n              payload: response.data.token\n            });\n            _context2.next = 13;\n            break;\n\n          case 10:\n            _context2.prev = 10;\n            _context2.t0 = _context2[\"catch\"](1);\n            dispatch({\n              type: 'add_error',\n              payload: 'Something went wrong with signup'\n            });\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 10]], Promise);\n  };\n};\n\nvar signout = function signout(dispatch) {\n  return function _callee3() {\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem('token'));\n\n          case 2:\n            dispatch({\n              type: 'signout'\n            });\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar tryLocalSignIn = function tryLocalSignIn(dispatch) {\n  return function _callee4() {\n    var token;\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem('token'));\n\n          case 2:\n            token = _context4.sent;\n            dispatch({\n              type: 'check_token'\n            });\n\n            if (token) {\n              dispatch({\n                type: 'signin',\n                payload: token\n              });\n            }\n\n          case 5:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar _createDataContext = createDataContext(authReducer, {\n  signin: signin,\n  signup: signup,\n  signout: signout,\n  clearErrorMessage: clearErrorMessage,\n  tryLocalSignIn: tryLocalSignIn\n}, {\n  token: null,\n  errorMessage: '',\n  tokenChecked: false\n}),\n    Provider = _createDataContext.Provider,\n    Context = _createDataContext.Context;\n\nexport { Provider, Context };","map":{"version":3,"sources":["D:/Projects/Javascript/tracks/src/context/AuthContext.js"],"names":["AsyncStorage","createDataContext","trackerApi","RootNavigation","authReducer","state","action","type","errorMessage","payload","token","tokenChecked","clearErrorMessage","dispatch","signin","email","password","post","response","setItem","data","console","log","signup","signout","removeItem","tryLocalSignIn","getItem","Provider","Context"],"mappings":"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","sourcesContent":["import {AsyncStorage} from 'react-native'\r\nimport createDataContext from './createDataContext'\r\nimport trackerApi from '../api/tracker'\r\nimport * as RootNavigation from '../../RootNavigation.js';\r\n\r\nconst authReducer = (state, action) => {\r\n  switch(action.type) {\r\n    case 'add_error':\r\n      return {...state, errorMessage: action.payload}\r\n    case 'signin':\r\n      return {...state, errorMessage: '', token: action.payload}\r\n    case 'clear_error_message':\r\n      return {...state, errorMessage: ''}\r\n    case 'check_token':\r\n      return {...state, tokenChecked: true}\r\n    case 'signout':\r\n      return {...state, token: null, errorMessage: ''}\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\n\r\nconst clearErrorMessage = dispatch => () => {\r\n  dispatch({type: 'clear_error_message'})\r\n}\r\n\r\nconst signin = (dispatch) => {\r\n  return async ({email, password}) => {\r\n    try {\r\n      const response = await trackerApi.post('/signin', {email, password})\r\n      await AsyncStorage.setItem('token', response.data.token)\r\n      dispatch({type:'signin', payload: response.data.token})\r\n    } catch (err) {\r\n      console.log(err)\r\n      dispatch({type: 'add_error', payload: 'Something went wrong with signin'})\r\n    }\r\n  }\r\n}\r\n\r\nconst signup = (dispatch) => {\r\n  return async ({email, password}) => {\r\n    try {\r\n      const response = await trackerApi.post('/signup', {email, password})\r\n      await AsyncStorage.setItem('token', response.data.token)\r\n      dispatch({type:'signin', payload: response.data.token})\r\n    } catch (err) {\r\n      dispatch({type: 'add_error', payload: 'Something went wrong with signup'})\r\n    }\r\n  }\r\n}\r\n\r\nconst signout = (dispatch) => async () => {\r\n  await AsyncStorage.removeItem('token')\r\n  dispatch({type: 'signout'})\r\n}\r\n\r\n\r\nconst tryLocalSignIn = dispatch => async () => {\r\n  const token = await AsyncStorage.getItem('token')\r\n  dispatch({type: 'check_token'})\r\n  if (token) {\r\n    dispatch({type: 'signin', payload: token})\r\n  }\r\n}\r\n\r\nexport const {Provider, Context} = createDataContext(\r\n  authReducer,\r\n  {signin, signup, signout, clearErrorMessage, tryLocalSignIn},\r\n  {token: null, errorMessage: '', tokenChecked: false}\r\n  )"]},"metadata":{},"sourceType":"module"}